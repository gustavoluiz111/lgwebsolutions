<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atena - Login</title>
  <style>
    /* ==== VARIÁVEIS ==== */
    :root {
      --brand: #4b70e2;
      --bg-dark: #0e0e0e;
      --bg-light: #f9f9f9;
      --text-dark: #fff;
      --text-light: #111;
      --gray-platform: #b0b0b0;
    }

    /* ==== RESET ==== */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
    body { background: var(--bg-dark); color: var(--text-dark); line-height: 1.6; display: flex; justify-content: center; align-items: center; height: 100vh; }

    /* ==== CONTAINER PRINCIPAL ==== */
    .login-container { width: 350px; background: #1f1f1f; padding: 30px; border-radius: 15px; box-shadow: 0 0 20px rgba(75,112,226,0.3); text-align: center; }

    /* ==== LOGO ==== */
    .logo img { width: 80px; height: auto; margin-bottom: 20px; }

    /* ==== TÍTULOS ==== */
    .login-container h2 { margin-bottom: 20px; color: var(--brand); }

    /* ==== FORMULÁRIOS ==== */
    .form-card { display: none; flex-direction: column; gap: 15px; }
    .form-card.active { display: flex; }

    input { padding: 10px; border-radius: 8px; border: none; outline: none; font-size: 1rem; }

    input:focus { box-shadow: 0 0 5px var(--brand); }

    /* ==== BOTÕES ==== */
    .btn { padding: 10px 20px; border: none; border-radius: 8px; background: var(--brand); color: #fff; font-weight: bold; cursor: pointer; transition: 0.3s; }
    .btn:hover { opacity: 0.9; }

    .btn-ghost { background: transparent; border: 2px solid #fff; color: #fff; }
    .btn-ghost:hover { border-color: var(--brand); color: var(--brand); }

    /* ==== LINKS ==== */
    .switch-link { color: var(--brand); cursor: pointer; text-decoration: underline; font-size: 0.9rem; }

    /* ==== INÍCIO ==== */
    .inicio-btn { margin-top: 15px; display: inline-block; text-decoration: none; color: #fff; font-weight: bold; }
  </style>
</head>
<body>

  <div class="login-container">
    <img src="logoatena.png" alt="Logo Atena">
    <h2>Atena</h2>

    <!-- FORMULÁRIO DE CADASTRO -->
    <div id="cadastroCard" class="form-card active">
      <input type="text" id="nomeCadastro" placeholder="Nome completo" required>
      <input type="email" id="emailCadastro" placeholder="Email" required>
      <input type="password" id="senhaCadastro" placeholder="Senha" required>
      <input type="text" id="chaveCadastro" placeholder="Chave de acesso" required>
      <button class="btn" onclick="cadastrarUsuario()">Cadastre-se</button>
      <p>Já possui conta? <span class="switch-link" onclick="mostrarLogin()">Já sou aluno</span></p>
    </div>

    <!-- FORMULÁRIO DE LOGIN -->
    <div id="loginCard" class="form-card">
      <input type="email" id="emailLogin" placeholder="Email" required>
      <input type="password" id="senhaLogin" placeholder="Senha" required>
      <button class="btn" onclick="loginUsuario()">Já sou aluno</button>
      <p>Não possui conta? <span class="switch-link" onclick="mostrarCadastro()">Cadastre-se</span></p>
    </div>

    <a href="index.html" class="inicio-btn">← Início</a>
  </div>

  <!-- ==== FIREBASE ==== -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // ==== CONFIGURAÇÃO FIREBASE ====
    const firebaseConfig = {
      apiKey: "AIzaSyCrQVOUQsWJGKpMO6ceGwshIKVkkuzJKxI",
      authDomain: "plataforma-estudos-570f3.firebaseapp.com",
      projectId: "plataforma-estudos-570f3",
      storageBucket: "plataforma-estudos-570f3.appspot.com",
      messagingSenderId: "1096880393119",
      appId: "1:1096880393119:web:EXEMPLO123456"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // ==== SWITCH FORMULÁRIO ====
    function mostrarLogin() {
      document.getElementById('cadastroCard').classList.remove('active');
      document.getElementById('loginCard').classList.add('active');
    }

    function mostrarCadastro() {
      document.getElementById('loginCard').classList.remove('active');
      document.getElementById('cadastroCard').classList.add('active');
    }

    // ==== CADASTRO ====
    function cadastrarUsuario() {
      const nome = document.getElementById('nomeCadastro').value;
      const email = document.getElementById('emailCadastro').value;
      const senha = document.getElementById('senhaCadastro').value;
      const chave = document.getElementById('chaveCadastro').value;

      if (!nome || !email || !senha || !chave) {
        alert("Preencha todos os campos!");
        return;
      }

      // Verifica chave no Firebase
      db.ref('chaves/' + chave).get().then(snapshot => {
        if (!snapshot.exists() || snapshot.val().usada) {
          alert("Chave inválida ou já utilizada!");
        } else {
          // Cria usuário no Firebase Auth
          auth.createUserWithEmailAndPassword(email, senha)
            .then(userCredential => {
              // Marca chave como usada
              db.ref('chaves/' + chave).update({ usada: true, usuario: userCredential.user.uid });
              alert("Cadastro realizado! Faça login agora.");
              mostrarLogin();
            })
            .catch(error => alert(error.message));
        }
      });
    }

    // ==== LOGIN ====
    function loginUsuario() {
      const email = document.getElementById('emailLogin').value;
      const senha = document.getElementById('senhaLogin').value;

      if (!email || !senha) {
        alert("Preencha todos os campos!");
        return;
      }

      auth.signInWithEmailAndPassword(email, senha)
        .then(() => {
          // Redireciona para dashboard (painel do aluno)
          window.location.href = "painel.html";
        })
        .catch(error => alert(error.message));
    }
  </script>
</body>
</html>
